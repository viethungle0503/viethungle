"use strict";(self.webpackChunkviethungle_0503=self.webpackChunkviethungle_0503||[]).push([[9306],{2518:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>h,contentTitle:()=>a,default:()=>o,frontMatter:()=>t,metadata:()=>c,toc:()=>s});const c=JSON.parse('{"id":"tutorials/nginx-proxy-manager-symlink-fix","title":"Kh\u1eafc Ph\u1ee5c Symlink Nginx Proxy Manager Sau Backup Th\u1ee7 C\xf4ng","description":"Khi b\u1ea1n backup Nginx Proxy Manager b\u1eb1ng c\xe1ch copy th\u1ee7 c\xf4ng th\u01b0 m\u1ee5c, c\xe1c symlink c\u1ee7a Let\'s Encrypt c\xf3 th\u1ec3 b\u1ecb h\u1ecfng, d\u1eabn \u0111\u1ebfn l\u1ed7i gia h\u1ea1n ch\u1ee9ng ch\u1ec9 SSL. B\xe0i h\u01b0\u1edbng d\u1eabn n\xe0y s\u1ebd gi\xfap b\u1ea1n kh\u1eafc ph\u1ee5c v\u1ea5n \u0111\u1ec1 n\xe0y.","source":"@site/docs/tutorials/nginx-proxy-manager-symlink-fix.md","sourceDirName":"tutorials","slug":"/tutorials/nginx-proxy-manager-symlink-fix","permalink":"/viethungle/docs/tutorials/nginx-proxy-manager-symlink-fix","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/nginx-proxy-manager-symlink-fix.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Cleaning Up Git Branches","permalink":"/viethungle/docs/tutorials/cleanup-git-branches"},"next":{"title":"Fixing Nginx Proxy Manager Symlinks After Manual Backup","permalink":"/viethungle/docs/tutorials/nginx-proxy-manager-symlink-fix-en"}}');var r=i(4848),l=i(8453);const t={sidebar_position:3},a="Kh\u1eafc Ph\u1ee5c Symlink Nginx Proxy Manager Sau Backup Th\u1ee7 C\xf4ng",h={},s=[{value:"1. Hi\u1ec3u V\u1ea5n \u0110\u1ec1",id:"1-hi\u1ec3u-v\u1ea5n-\u0111\u1ec1",level:2},{value:"1.1. Nguy\xean Nh\xe2n L\u1ed7i",id:"11-nguy\xean-nh\xe2n-l\u1ed7i",level:3},{value:"1.2. L\u1ed7i Th\u01b0\u1eddng G\u1eb7p",id:"12-l\u1ed7i-th\u01b0\u1eddng-g\u1eb7p",level:3},{value:"2. Ki\u1ec3m Tra T\xecnh Tr\u1ea1ng Hi\u1ec7n T\u1ea1i",id:"2-ki\u1ec3m-tra-t\xecnh-tr\u1ea1ng-hi\u1ec7n-t\u1ea1i",level:2},{value:"2.1. X\xe1c \u0110\u1ecbnh \u0110\u01b0\u1eddng D\u1eabn Volume",id:"21-x\xe1c-\u0111\u1ecbnh-\u0111\u01b0\u1eddng-d\u1eabn-volume",level:3},{value:"2.2. Ki\u1ec3m Tra C\u1ea5u Tr\xfac Th\u01b0 M\u1ee5c",id:"22-ki\u1ec3m-tra-c\u1ea5u-tr\xfac-th\u01b0-m\u1ee5c",level:3},{value:"2.3. X\xe1c \u0110\u1ecbnh C\xe1c Certificate B\u1ecb L\u1ed7i",id:"23-x\xe1c-\u0111\u1ecbnh-c\xe1c-certificate-b\u1ecb-l\u1ed7i",level:3},{value:"3. Kh\u1eafc Ph\u1ee5c Symlink",id:"3-kh\u1eafc-ph\u1ee5c-symlink",level:2},{value:"3.1. Ph\u01b0\u01a1ng Ph\xe1p 1: T\u1ea1o L\u1ea1i Symlink T\u01b0\u01a1ng \u0110\u1ed1i (Khuy\u1ebfn Ngh\u1ecb)",id:"31-ph\u01b0\u01a1ng-ph\xe1p-1-t\u1ea1o-l\u1ea1i-symlink-t\u01b0\u01a1ng-\u0111\u1ed1i-khuy\u1ebfn-ngh\u1ecb",level:3},{value:"3.1.1. B\u01b0\u1edbc 1: Di Chuy\u1ec3n V\xe0o Th\u01b0 M\u1ee5c Live",id:"311-b\u01b0\u1edbc-1-di-chuy\u1ec3n-v\xe0o-th\u01b0-m\u1ee5c-live",level:4},{value:"3.1.2. B\u01b0\u1edbc 2: X\xf3a C\xe1c File/Symlink C\u0169",id:"312-b\u01b0\u1edbc-2-x\xf3a-c\xe1c-filesymlink-c\u0169",level:4},{value:"3.1.3. B\u01b0\u1edbc 3: X\xe1c \u0110\u1ecbnh S\u1ed1 Phi\xean B\u1ea3n Certificate",id:"313-b\u01b0\u1edbc-3-x\xe1c-\u0111\u1ecbnh-s\u1ed1-phi\xean-b\u1ea3n-certificate",level:4},{value:"3.1.4. B\u01b0\u1edbc 4: T\u1ea1o Symlink T\u01b0\u01a1ng \u0110\u1ed1i",id:"314-b\u01b0\u1edbc-4-t\u1ea1o-symlink-t\u01b0\u01a1ng-\u0111\u1ed1i",level:4},{value:"3.1.5. B\u01b0\u1edbc 5: X\xe1c Minh Symlink",id:"315-b\u01b0\u1edbc-5-x\xe1c-minh-symlink",level:4},{value:"3.2. Ph\u01b0\u01a1ng Ph\xe1p 2: Script T\u1ef1 \u0110\u1ed9ng",id:"32-ph\u01b0\u01a1ng-ph\xe1p-2-script-t\u1ef1-\u0111\u1ed9ng",level:3},{value:"4. Kh\u1edfi \u0110\u1ed9ng L\u1ea1i Container",id:"4-kh\u1edfi-\u0111\u1ed9ng-l\u1ea1i-container",level:2},{value:"5. Ki\u1ec3m Tra K\u1ebft Qu\u1ea3",id:"5-ki\u1ec3m-tra-k\u1ebft-qu\u1ea3",level:2},{value:"5.1. Ki\u1ec3m Tra Logs",id:"51-ki\u1ec3m-tra-logs",level:3},{value:"5.2. Test Gia H\u1ea1n Certificate",id:"52-test-gia-h\u1ea1n-certificate",level:3},{value:"5.3. Ki\u1ec3m Tra Trong NPM Interface",id:"53-ki\u1ec3m-tra-trong-npm-interface",level:3},{value:"6. Ng\u0103n Ng\u1eeba V\u1ea5n \u0110\u1ec1 Trong T\u01b0\u01a1ng Lai",id:"6-ng\u0103n-ng\u1eeba-v\u1ea5n-\u0111\u1ec1-trong-t\u01b0\u01a1ng-lai",level:2},{value:"6.1. S\u1eed D\u1ee5ng Docker Volume Backup",id:"61-s\u1eed-d\u1ee5ng-docker-volume-backup",level:3},{value:"6.2. S\u1eed D\u1ee5ng Rsync V\u1edbi Symlink",id:"62-s\u1eed-d\u1ee5ng-rsync-v\u1edbi-symlink",level:3},{value:"6.3. T\u1ea1o Script Backup T\u1ef1 \u0110\u1ed9ng",id:"63-t\u1ea1o-script-backup-t\u1ef1-\u0111\u1ed9ng",level:3},{value:"7. Troubleshooting",id:"7-troubleshooting",level:2},{value:"7.1. L\u1ed7i: &quot;target does not exist&quot;",id:"71-l\u1ed7i-target-does-not-exist",level:3},{value:"7.2. Kh\xf4ng T\xecm Th\u1ea5y File Archive",id:"72-kh\xf4ng-t\xecm-th\u1ea5y-file-archive",level:3},{value:"7.3. Multiple Certificates",id:"73-multiple-certificates",level:3},{value:"8. K\u1ebft Lu\u1eadn",id:"8-k\u1ebft-lu\u1eadn",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"kh\u1eafc-ph\u1ee5c-symlink-nginx-proxy-manager-sau-backup-th\u1ee7-c\xf4ng",children:"Kh\u1eafc Ph\u1ee5c Symlink Nginx Proxy Manager Sau Backup Th\u1ee7 C\xf4ng"})}),"\n",(0,r.jsx)(e.p,{children:"Khi b\u1ea1n backup Nginx Proxy Manager b\u1eb1ng c\xe1ch copy th\u1ee7 c\xf4ng th\u01b0 m\u1ee5c, c\xe1c symlink c\u1ee7a Let's Encrypt c\xf3 th\u1ec3 b\u1ecb h\u1ecfng, d\u1eabn \u0111\u1ebfn l\u1ed7i gia h\u1ea1n ch\u1ee9ng ch\u1ec9 SSL. B\xe0i h\u01b0\u1edbng d\u1eabn n\xe0y s\u1ebd gi\xfap b\u1ea1n kh\u1eafc ph\u1ee5c v\u1ea5n \u0111\u1ec1 n\xe0y."}),"\n",(0,r.jsx)(e.h2,{id:"1-hi\u1ec3u-v\u1ea5n-\u0111\u1ec1",children:"1. Hi\u1ec3u V\u1ea5n \u0110\u1ec1"}),"\n",(0,r.jsx)(e.h3,{id:"11-nguy\xean-nh\xe2n-l\u1ed7i",children:"1.1. Nguy\xean Nh\xe2n L\u1ed7i"}),"\n",(0,r.jsx)(e.p,{children:"Khi backup th\u1ee7 c\xf4ng, vi\u1ec7c copy/paste th\u01b0 m\u1ee5c c\xf3 th\u1ec3 l\xe0m m\u1ea5t c\xe1c symbolic link (symlink) c\u1ee7a Let's Encrypt. Nh\u1eefng symlink n\xe0y r\u1ea5t quan tr\u1ecdng v\xec:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Ch\xfang li\xean k\u1ebft c\xe1c file trong ",(0,r.jsx)(e.code,{children:"/etc/letsencrypt/live/"})," v\u1edbi c\xe1c file th\u1ef1c t\u1ebf trong ",(0,r.jsx)(e.code,{children:"/etc/letsencrypt/archive/"})]}),"\n",(0,r.jsx)(e.li,{children:"Certbot c\u1ea7n c\xe1c symlink n\xe0y \u0111\u1ec3 qu\u1ea3n l\xfd v\xe0 gia h\u1ea1n ch\u1ee9ng ch\u1ec9"}),"\n",(0,r.jsx)(e.li,{children:"Khi m\u1ea5t symlink, Certbot kh\xf4ng th\u1ec3 t\xecm th\u1ea5y ch\u1ee9ng ch\u1ec9 \u0111\u1ec3 gia h\u1ea1n"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"12-l\u1ed7i-th\u01b0\u1eddng-g\u1eb7p",children:"1.2. L\u1ed7i Th\u01b0\u1eddng G\u1eb7p"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'{\r\n    "error": {\r\n        "message": "Internal Error"\r\n    },\r\n    "debug": {\r\n        "stack": [\r\n            "Renewal configuration file /etc/letsencrypt/renewal/npm-2.conf is broken.",\r\n            "The error was: expected /etc/letsencrypt/live/npm-2/cert.pem to be a symlink",\r\n            "Skipping."\r\n        ]\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"2-ki\u1ec3m-tra-t\xecnh-tr\u1ea1ng-hi\u1ec7n-t\u1ea1i",children:"2. Ki\u1ec3m Tra T\xecnh Tr\u1ea1ng Hi\u1ec7n T\u1ea1i"}),"\n",(0,r.jsx)(e.h3,{id:"21-x\xe1c-\u0111\u1ecbnh-\u0111\u01b0\u1eddng-d\u1eabn-volume",children:"2.1. X\xe1c \u0110\u1ecbnh \u0110\u01b0\u1eddng D\u1eabn Volume"}),"\n",(0,r.jsx)(e.p,{children:"\u0110\u1ea7u ti\xean, x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1eddng d\u1eabn volume c\u1ee7a Nginx Proxy Manager tr\xean host:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'docker inspect <container_name> | grep -A 5 -B 5 "letsencrypt"\n'})}),"\n",(0,r.jsxs)(e.p,{children:["Ho\u1eb7c ki\u1ec3m tra trong file ",(0,r.jsx)(e.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"volumes:\r\n  - /home/ubuntu/nginxproxymanager/letsencrypt:/etc/letsencrypt\n"})}),"\n",(0,r.jsx)(e.h3,{id:"22-ki\u1ec3m-tra-c\u1ea5u-tr\xfac-th\u01b0-m\u1ee5c",children:"2.2. Ki\u1ec3m Tra C\u1ea5u Tr\xfac Th\u01b0 M\u1ee5c"}),"\n",(0,r.jsx)(e.p,{children:"Ki\u1ec3m tra th\u01b0 m\u1ee5c live:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ls -la /home/ubuntu/nginxproxymanager/letsencrypt/live/npm-2/\n"})}),"\n",(0,r.jsx)(e.p,{children:"Ki\u1ec3m tra th\u01b0 m\u1ee5c archive:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ls -la /home/ubuntu/nginxproxymanager/letsencrypt/archive/npm-2/\n"})}),"\n",(0,r.jsx)(e.h3,{id:"23-x\xe1c-\u0111\u1ecbnh-c\xe1c-certificate-b\u1ecb-l\u1ed7i",children:"2.3. X\xe1c \u0110\u1ecbnh C\xe1c Certificate B\u1ecb L\u1ed7i"}),"\n",(0,r.jsx)(e.p,{children:"Li\u1ec7t k\xea t\u1ea5t c\u1ea3 c\xe1c certificate:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ls /home/ubuntu/nginxproxymanager/letsencrypt/live/\n"})}),"\n",(0,r.jsx)(e.h2,{id:"3-kh\u1eafc-ph\u1ee5c-symlink",children:"3. Kh\u1eafc Ph\u1ee5c Symlink"}),"\n",(0,r.jsx)(e.h3,{id:"31-ph\u01b0\u01a1ng-ph\xe1p-1-t\u1ea1o-l\u1ea1i-symlink-t\u01b0\u01a1ng-\u0111\u1ed1i-khuy\u1ebfn-ngh\u1ecb",children:"3.1. Ph\u01b0\u01a1ng Ph\xe1p 1: T\u1ea1o L\u1ea1i Symlink T\u01b0\u01a1ng \u0110\u1ed1i (Khuy\u1ebfn Ngh\u1ecb)"}),"\n",(0,r.jsx)(e.h4,{id:"311-b\u01b0\u1edbc-1-di-chuy\u1ec3n-v\xe0o-th\u01b0-m\u1ee5c-live",children:"3.1.1. B\u01b0\u1edbc 1: Di Chuy\u1ec3n V\xe0o Th\u01b0 M\u1ee5c Live"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"cd /home/ubuntu/nginxproxymanager/letsencrypt/live/npm-2\n"})}),"\n",(0,r.jsx)(e.h4,{id:"312-b\u01b0\u1edbc-2-x\xf3a-c\xe1c-filesymlink-c\u0169",children:"3.1.2. B\u01b0\u1edbc 2: X\xf3a C\xe1c File/Symlink C\u0169"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"sudo rm -f cert.pem privkey.pem chain.pem fullchain.pem\n"})}),"\n",(0,r.jsx)(e.h4,{id:"313-b\u01b0\u1edbc-3-x\xe1c-\u0111\u1ecbnh-s\u1ed1-phi\xean-b\u1ea3n-certificate",children:"3.1.3. B\u01b0\u1edbc 3: X\xe1c \u0110\u1ecbnh S\u1ed1 Phi\xean B\u1ea3n Certificate"}),"\n",(0,r.jsx)(e.p,{children:"Ki\u1ec3m tra th\u01b0 m\u1ee5c archive \u0111\u1ec3 x\xe1c \u0111\u1ecbnh s\u1ed1 phi\xean b\u1ea3n m\u1edbi nh\u1ea5t:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ls -la ../../archive/npm-2/\n"})}),"\n",(0,r.jsx)(e.p,{children:"B\u1ea1n s\u1ebd th\u1ea5y c\xe1c file nh\u01b0:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"cert1.pem"}),", ",(0,r.jsx)(e.code,{children:"cert2.pem"}),", ..."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"privkey1.pem"}),", ",(0,r.jsx)(e.code,{children:"privkey2.pem"}),", ..."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"chain1.pem"}),", ",(0,r.jsx)(e.code,{children:"chain2.pem"}),", ..."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"fullchain1.pem"}),", ",(0,r.jsx)(e.code,{children:"fullchain2.pem"}),", ..."]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"314-b\u01b0\u1edbc-4-t\u1ea1o-symlink-t\u01b0\u01a1ng-\u0111\u1ed1i",children:"3.1.4. B\u01b0\u1edbc 4: T\u1ea1o Symlink T\u01b0\u01a1ng \u0110\u1ed1i"}),"\n",(0,r.jsxs)(e.p,{children:["S\u1eed d\u1ee5ng s\u1ed1 phi\xean b\u1ea3n cao nh\u1ea5t (v\xed d\u1ee5: ",(0,r.jsx)(e.code,{children:"1"}),"):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"sudo ln -sf ../../archive/npm-2/cert1.pem cert.pem\r\nsudo ln -sf ../../archive/npm-2/privkey1.pem privkey.pem  \r\nsudo ln -sf ../../archive/npm-2/chain1.pem chain.pem\r\nsudo ln -sf ../../archive/npm-2/fullchain1.pem fullchain.pem\n"})}),"\n",(0,r.jsx)(e.h4,{id:"315-b\u01b0\u1edbc-5-x\xe1c-minh-symlink",children:"3.1.5. B\u01b0\u1edbc 5: X\xe1c Minh Symlink"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ls -la\n"})}),"\n",(0,r.jsx)(e.p,{children:"K\u1ebft qu\u1ea3 mong mu\u1ed1n:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"cert.pem -> ../../archive/npm-2/cert1.pem\r\nprivkey.pem -> ../../archive/npm-2/privkey1.pem\r\nchain.pem -> ../../archive/npm-2/chain1.pem\r\nfullchain.pem -> ../../archive/npm-2/fullchain1.pem\n"})}),"\n",(0,r.jsx)(e.h3,{id:"32-ph\u01b0\u01a1ng-ph\xe1p-2-script-t\u1ef1-\u0111\u1ed9ng",children:"3.2. Ph\u01b0\u01a1ng Ph\xe1p 2: Script T\u1ef1 \u0110\u1ed9ng"}),"\n",(0,r.jsx)(e.p,{children:"T\u1ea1o script \u0111\u1ec3 t\u1ef1 \u0111\u1ed9ng kh\u1eafc ph\u1ee5c nhi\u1ec1u certificate:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\r\n\r\n# \u0110\u01b0\u1eddng d\u1eabn \u0111\u1ebfn th\u01b0 m\u1ee5c letsencrypt\r\nLETSENCRYPT_PATH="/home/ubuntu/nginxproxymanager/letsencrypt"\r\n\r\n# T\xecm t\u1ea5t c\u1ea3 c\xe1c certificate\r\nfor cert_dir in "$LETSENCRYPT_PATH/live"/*; do\r\n    if [ -d "$cert_dir" ]; then\r\n        cert_name=$(basename "$cert_dir")\r\n        echo "\u0110ang x\u1eed l\xfd certificate: $cert_name"\r\n        \r\n        # Di chuy\u1ec3n v\xe0o th\u01b0 m\u1ee5c live\r\n        cd "$cert_dir"\r\n        \r\n        # X\xf3a symlink/file c\u0169\r\n        sudo rm -f cert.pem privkey.pem chain.pem fullchain.pem\r\n        \r\n        # T\xecm phi\xean b\u1ea3n m\u1edbi nh\u1ea5t\r\n        latest_num=$(ls ../../archive/"$cert_name"/cert*.pem | grep -o \'[0-9]\\+\' | sort -n | tail -1)\r\n        \r\n        # T\u1ea1o symlink m\u1edbi\r\n        sudo ln -sf "../../archive/$cert_name/cert${latest_num}.pem" cert.pem\r\n        sudo ln -sf "../../archive/$cert_name/privkey${latest_num}.pem" privkey.pem\r\n        sudo ln -sf "../../archive/$cert_name/chain${latest_num}.pem" chain.pem\r\n        sudo ln -sf "../../archive/$cert_name/fullchain${latest_num}.pem" fullchain.pem\r\n        \r\n        echo "Ho\xe0n th\xe0nh $cert_name"\r\n    fi\r\ndone\n'})}),"\n",(0,r.jsx)(e.h2,{id:"4-kh\u1edfi-\u0111\u1ed9ng-l\u1ea1i-container",children:"4. Kh\u1edfi \u0110\u1ed9ng L\u1ea1i Container"}),"\n",(0,r.jsx)(e.p,{children:"Sau khi kh\u1eafc ph\u1ee5c symlink, kh\u1edfi \u0111\u1ed9ng l\u1ea1i container:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# V\u1edbi Docker Compose\r\ndocker-compose restart nginx-proxy-manager\r\n\r\n# V\u1edbi Docker th\u01b0\u1eddng\r\ndocker restart <container_name>\n"})}),"\n",(0,r.jsx)(e.h2,{id:"5-ki\u1ec3m-tra-k\u1ebft-qu\u1ea3",children:"5. Ki\u1ec3m Tra K\u1ebft Qu\u1ea3"}),"\n",(0,r.jsx)(e.h3,{id:"51-ki\u1ec3m-tra-logs",children:"5.1. Ki\u1ec3m Tra Logs"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"docker logs <container_name>\n"})}),"\n",(0,r.jsx)(e.h3,{id:"52-test-gia-h\u1ea1n-certificate",children:"5.2. Test Gia H\u1ea1n Certificate"}),"\n",(0,r.jsx)(e.p,{children:"V\xe0o trong container v\xe0 test:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"docker exec -it <container_name> bash\r\ncertbot renew --dry-run -v\n"})}),"\n",(0,r.jsx)(e.h3,{id:"53-ki\u1ec3m-tra-trong-npm-interface",children:"5.3. Ki\u1ec3m Tra Trong NPM Interface"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u0110\u0103ng nh\u1eadp v\xe0o Nginx Proxy Manager"}),"\n",(0,r.jsx)(e.li,{children:"Ki\u1ec3m tra SSL Certificates"}),"\n",(0,r.jsx)(e.li,{children:"Th\u1eed force renew m\u1ed9t certificate"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"6-ng\u0103n-ng\u1eeba-v\u1ea5n-\u0111\u1ec1-trong-t\u01b0\u01a1ng-lai",children:"6. Ng\u0103n Ng\u1eeba V\u1ea5n \u0110\u1ec1 Trong T\u01b0\u01a1ng Lai"}),"\n",(0,r.jsx)(e.h3,{id:"61-s\u1eed-d\u1ee5ng-docker-volume-backup",children:"6.1. S\u1eed D\u1ee5ng Docker Volume Backup"}),"\n",(0,r.jsx)(e.p,{children:"Thay v\xec copy th\u1ee7 c\xf4ng, s\u1eed d\u1ee5ng:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Backup volume\r\ndocker run --rm -v nginx-proxy-manager_letsencrypt:/source -v $(pwd):/backup alpine tar czf /backup/letsencrypt-backup.tar.gz -C /source .\r\n\r\n# Restore volume\r\ndocker run --rm -v nginx-proxy-manager_letsencrypt:/target -v $(pwd):/backup alpine tar xzf /backup/letsencrypt-backup.tar.gz -C /target\n"})}),"\n",(0,r.jsx)(e.h3,{id:"62-s\u1eed-d\u1ee5ng-rsync-v\u1edbi-symlink",children:"6.2. S\u1eed D\u1ee5ng Rsync V\u1edbi Symlink"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"rsync -avh --links /source/nginxproxymanager/ /backup/nginxproxymanager/\n"})}),"\n",(0,r.jsx)(e.h3,{id:"63-t\u1ea1o-script-backup-t\u1ef1-\u0111\u1ed9ng",children:"6.3. T\u1ea1o Script Backup T\u1ef1 \u0110\u1ed9ng"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\r\n\r\nBACKUP_DIR="/backup/npm-$(date +%Y%m%d-%H%M%S)"\r\nSOURCE_DIR="/home/ubuntu/nginxproxymanager"\r\n\r\nmkdir -p "$BACKUP_DIR"\r\n\r\n# Backup v\u1edbi preserve symlinks\r\nrsync -avh --links "$SOURCE_DIR/" "$BACKUP_DIR/"\r\n\r\necho "Backup completed: $BACKUP_DIR"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"7-troubleshooting",children:"7. Troubleshooting"}),"\n",(0,r.jsx)(e.h3,{id:"71-l\u1ed7i-target-does-not-exist",children:'7.1. L\u1ed7i: "target does not exist"'}),"\n",(0,r.jsx)(e.p,{children:"N\u1ebfu b\u1ea1n th\u1ea5y l\u1ed7i n\xe0y, c\xf3 ngh\u0129a l\xe0 b\u1ea1n \u0111\xe3 t\u1ea1o symlink tuy\u1ec7t \u0111\u1ed1i thay v\xec t\u01b0\u01a1ng \u0111\u1ed1i:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# SAI - symlink tuy\u1ec7t \u0111\u1ed1i\r\nsudo ln -sf /home/ubuntu/nginxproxymanager/letsencrypt/archive/npm-2/cert1.pem cert.pem\r\n\r\n# \u0110\xdaNG - symlink t\u01b0\u01a1ng \u0111\u1ed1i  \r\nsudo ln -sf ../../archive/npm-2/cert1.pem cert.pem\n"})}),"\n",(0,r.jsx)(e.h3,{id:"72-kh\xf4ng-t\xecm-th\u1ea5y-file-archive",children:"7.2. Kh\xf4ng T\xecm Th\u1ea5y File Archive"}),"\n",(0,r.jsx)(e.p,{children:"N\u1ebfu kh\xf4ng c\xf3 file trong archive, c\xf3 th\u1ec3 certificate \u0111\xe3 b\u1ecb m\u1ea5t ho\xe0n to\xe0n:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"X\xf3a certificate c\u0169:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"docker exec -it <container_name> certbot delete --cert-name npm-2\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"T\u1ea1o certificate m\u1edbi qua NPM interface"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"73-multiple-certificates",children:"7.3. Multiple Certificates"}),"\n",(0,r.jsx)(e.p,{children:"\u0110\u1ed1i v\u1edbi nhi\u1ec1u certificate (npm-2, npm-4, ...):"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'for cert in npm-2 npm-4; do\r\n    echo "Processing $cert..."\r\n    cd "/home/ubuntu/nginxproxymanager/letsencrypt/live/$cert"\r\n    sudo rm -f *.pem\r\n    latest=$(ls ../../archive/$cert/cert*.pem | grep -o \'[0-9]\\+\' | sort -n | tail -1)\r\n    sudo ln -sf "../../archive/$cert/cert${latest}.pem" cert.pem\r\n    sudo ln -sf "../../archive/$cert/privkey${latest}.pem" privkey.pem\r\n    sudo ln -sf "../../archive/$cert/chain${latest}.pem" chain.pem\r\n    sudo ln -sf "../../archive/$cert/fullchain${latest}.pem" fullchain.pem\r\ndone\n'})}),"\n",(0,r.jsx)(e.h2,{id:"8-k\u1ebft-lu\u1eadn",children:"8. K\u1ebft Lu\u1eadn"}),"\n",(0,r.jsx)(e.p,{children:"Vi\u1ec7c kh\u1eafc ph\u1ee5c symlink sau backup th\u1ee7 c\xf4ng l\xe0 c\u1ea7n thi\u1ebft \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o Nginx Proxy Manager ho\u1ea1t \u0111\u1ed9ng b\xecnh th\u01b0\u1eddng. H\xe3y nh\u1edb:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Lu\xf4n s\u1eed d\u1ee5ng symlink t\u01b0\u01a1ng \u0111\u1ed1i, kh\xf4ng ph\u1ea3i tuy\u1ec7t \u0111\u1ed1i"}),"\n",(0,r.jsx)(e.li,{children:"X\xe1c \u0111\u1ecbnh \u0111\xfang s\u1ed1 phi\xean b\u1ea3n certificate m\u1edbi nh\u1ea5t"}),"\n",(0,r.jsx)(e.li,{children:"Kh\u1edfi \u0111\u1ed9ng l\u1ea1i container sau khi s\u1eeda"}),"\n",(0,r.jsx)(e.li,{children:"S\u1eed d\u1ee5ng ph\u01b0\u01a1ng ph\xe1p backup \u0111\xfang c\xe1ch \u0111\u1ec3 tr\xe1nh v\u1ea5n \u0111\u1ec1 n\xe0y"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Trong t\u01b0\u01a1ng lai, h\xe3y c\xe2n nh\u1eafc s\u1eed d\u1ee5ng c\xe1c c\xf4ng c\u1ee5 backup chuy\xean d\u1ee5ng ho\u1eb7c Docker volume backup \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\xednh to\xe0n v\u1eb9n c\u1ee7a d\u1eef li\u1ec7u."})]})}function o(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>a});var c=i(6540);const r={},l=c.createContext(r);function t(n){const e=c.useContext(l);return c.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),c.createElement(l.Provider,{value:e},n.children)}}}]);